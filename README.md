# 中国象棋游戏

一个基于JavaFX开发的中国象棋游戏，支持本地对战、P2P网络对战、对局记录和复盘功能。

## 小组成员

| 姓名 | 学号 | 分工 |
|------|------|------|
|      |      |      |
|      |      |      |
|      |      |      |

---

## 功能特性

- ✅ 完整的象棋规则实现（车、马、炮、兵、象、士、将）
- ✅ 本地双人对战
- ✅ P2P网络对战（支持局域网和本地测试）
- ✅ 游戏设置（音效、动画、悔棋次数、计时器等）
- ✅ 对局记录保存和查看
- ✅ 对局复盘功能（支持手动步进和自动播放）
- ✅ 悔棋、求和、认输功能

## 环境要求

- JDK 8 或更高版本
- Maven 3.6 或更高版本
- JavaFX SDK

## 编译和运行

### 1. 克隆项目

```bash
git clone <repository-url>
cd Chinese_chess
```

### 2. 编译项目

```bash
mvn clean compile
```

### 3. 运行项目

```bash
mvn javafx:run
```

或者直接运行主类：

```bash
java -cp target/classes com.ydc.chess.MainApplication
```

## 操作手册

### 主菜单

启动游戏后，您将看到主菜单界面，包含以下选项：

- **本地对战**：在同一台电脑上进行双人对战
- **网络对战**：通过P2P网络与其他玩家对战
- **对局记录**：查看和复盘历史对局
- **设置**：调整游戏设置（音效、动画、悔棋次数等）
- **退出**：退出游戏

### 本地对战

1. 在主菜单点击"本地对战"
2. 红方先行，点击棋盘上的棋子进行选择
3. 点击目标位置移动棋子
4. 游戏过程中可以使用以下功能：
   - **悔棋**：撤销上一步操作（有次数限制）
   - **求和**：向对方提议和局
   - **认输**：主动认输结束游戏
   - **返回**：返回主菜单（会提示确认）

### 网络对战

#### 作为主机（创建游戏）

1. 在主菜单点击"网络对战"
2. 点击"创建主机"按钮
3. 等待其他玩家连接
4. 连接成功后自动进入游戏界面
5. 主机默认执红方

#### 作为客机（加入游戏）

**方式一：自动搜索**

1. 在主菜单点击"网络对战"
2. 点击"刷新列表"按钮搜索局域网内的主机
3. 从列表中选择要加入的主机
4. 点击"加入游戏"按钮
5. 连接成功后自动进入游戏界面
6. 客机默认执黑方

**方式二：手动输入IP**

1. 在主菜单点击"网络对战"
2. 在"手动输入IP"文本框中输入主机IP地址（例如：`127.0.0.1` 或 `192.168.1.100`）
3. 点击"连接"按钮
4. 连接成功后自动进入游戏界面

**注意事项：**

- 同一台电脑上可以运行两个实例进行测试（使用 `127.0.0.1` 或 `localhost`）
- 确保防火墙允许Java程序访问网络
- 主机和客机必须在同一局域网内（或使用本地回环地址）

### 对局记录

1. 在主菜单点击"对局记录"
2. 查看所有保存的对局记录列表
3. 点击记录查看详细信息
4. 点击"复盘"按钮进入复盘界面
5. 点击"删除"按钮删除不需要的记录

### 复盘功能

在复盘界面中，您可以：

- **上一步**：回退到上一步棋
- **下一步**：前进到下一步棋
- **自动播放**：自动播放所有走棋（可暂停）
- **速度调节**：调整自动播放的速度（0.5x - 3.0x）
- **返回**：返回对局记录列表

### 游戏设置

在设置界面中，您可以调整：

- **音效开关**：开启/关闭音效
- **动画开关**：开启/关闭动画效果
- **悔棋次数**：设置每局游戏的悔棋次数限制
- **计时器开关**：开启/关闭计时器
- **玩家名称**：设置玩家名称（用于对局记录）
- **主题**：选择棋盘主题（如果有多个主题）

设置会自动保存，下次启动游戏时生效。

## 游戏规则

### 基本规则

- 红方先行
- 轮流走棋
- 不能走导致自己被将军的棋
- 将帅不能面对面（在同一列且中间无棋子）

### 胜负判定

- **将死**：一方的将/帅被将军且无法化解
- **困毙**：一方的将/帅未被将军但无合法走法
- **认输**：一方主动认输
- **和局**：双方同意和局

### 棋子走法

- **车（俥）**：直线移动，不能越子
- **马（傌）**：走"日"字，不能蹩马腿
- **炮（炮）**：直线移动，吃子需隔一子
- **兵（兵）**：只能向前，过河后可左右移动
- **象（相）**：走"田"字，不能过河，不能塞象眼
- **士（仕）**：只能在九宫格内斜走
- **将（帅）**：只能在九宫格内移动，不能面对面

## 技术栈

- **JavaFX**：图形界面框架
- **Maven**：项目管理和构建工具
- **Gson**：JSON序列化/反序列化
- **Java Socket**：网络通信

## 项目结构

```
Chinese_chess/
├── src/main/java/com/ydc/chess/
│   ├── controller/          # 控制器
│   │   ├── GameBoardController.java      # 游戏界面控制器
│   │   ├── GameBoardService.java          # 游戏逻辑服务
│   │   ├── NetworkManager.java           # 网络管理器
│   │   ├── NetworkSetupController.java    # 网络设置控制器
│   │   ├── RecordsController.java         # 对局记录控制器
│   │   ├── ReplayBoardController.java     # 复盘界面控制器
│   │   └── ...
│   ├── model/               # 数据模型
│   │   ├── Board.java                     # 棋盘模型
│   │   ├── Piece.java                     # 棋子模型
│   │   ├── GameRecord.java                # 对局记录模型
│   │   └── ...
│   ├── network/             # 网络通信
│   │   ├── NetworkService.java            # 网络服务
│   │   └── NetworkMessage.java            # 网络消息
│   ├── rule/                # 规则引擎
│   │   ├── AbstractRule.java              # 规则基类
│   │   ├── ChariotRule.java               # 车规则
│   │   └── ...
│   ├── service/            # 业务服务
│   │   └── GameRecordService.java         # 对局记录服务
│   └── ui/                  # UI组件
│       ├── BoardRenderer.java             # 棋盘渲染器
│       └── ...
├── src/main/resources/      # 资源文件
│   └── com/ydc/chess/ui/    # FXML界面文件
├── game_records/            # 对局记录存储目录
└── pom.xml                  # Maven配置文件
```

## 常见问题

### Q: 网络对战无法连接？

A: 请检查：
1. 主机是否已创建游戏
2. IP地址是否正确
3. 防火墙是否允许Java程序访问网络
4. 主机和客机是否在同一网络

### Q: 对局记录没有保存？

A: 请确保：
1. 游戏正常结束（不是强制退出）
2. 在游戏结束对话框中选择"存储棋局记录"
3. `game_records` 目录有写入权限


## 许可证

本项目仅供学习和研究使用。
